#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –≤ Supabase

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."

# –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
LOCAL_DB="postgresql://bogdusikk@localhost:5432/chess_db"

# Supabase –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∏—Ç–µ [YOUR-PASSWORD] –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å)
SUPABASE_DB="postgresql://postgres.vcxbtbhfeiyzbylsyvpu:P9sn161616@aws-1-eu-central-1.pooler.supabase.com:5432/postgres"

# –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –±—ç–∫–∞–ø–∞
BACKUP_FILE="chess_db_backup_$(date +%Y%m%d_%H%M%S).sql"

echo "üì¶ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î..."
pg_dump -U bogdusikk -d chess_db --data-only --column-inserts > "$BACKUP_FILE"

if [ $? -eq 0 ]; then
    echo "‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: $BACKUP_FILE"
    echo "üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Supabase..."
    
    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ (–Ω–µ —Å—Ö–µ–º—É, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ Prisma)
    psql "$SUPABASE_DB" -f "$BACKUP_FILE" 2>&1 | grep -v "NOTICE" | grep -v "already exists"
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª..."
        rm "$BACKUP_FILE"
        echo "‚ú® –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase."
        echo "üíæ –§–∞–π–ª –±—ç–∫–∞–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: $BACKUP_FILE"
    fi
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î."
fi

